<!doctype html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" href="https://i.pinimg.com/1200x/7e/ec/b7/7eecb7ec1af9c6e2a0512df28558b2cd.jpg">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>osu!mania — Score/Combo Archives</title>

  <!-- JSZip (ZIP creation) -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

  <style>
    :root{
      --bg:#0b0c0f; --fg:#ececec; --muted:rgba(255,255,255,.65);
      --border:rgba(255,255,255,.12); --panel:rgba(255,255,255,.06);
      --r:14px; --shadow:0 18px 55px rgba(0,0,0,.55);
      --mono: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
      --sans: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:var(--sans); color:var(--fg);
      background:
        radial-gradient(1200px 900px at 20% 10%, rgba(120,110,255,.14), transparent 55%),
        radial-gradient(900px 700px at 85% 25%, rgba(0,255,210,.10), transparent 60%),
        var(--bg);
    }
    .app{
      height:100vh;
      display:flex;
      flex-direction:column;
      padding:14px;
      gap:12px;
    }
    header{
      display:flex; align-items:flex-end; justify-content:space-between; gap:10px; flex-wrap:wrap;
    }
    h1{margin:0;font-size:15px;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:12px;line-height:1.35}
    .grid{
      flex:1;
      min-height:0;
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:12px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }
    .card{
      min-height:0;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--border);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .hd{
      padding:10px 12px;
      border-bottom:1px solid var(--border);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .hd b{font-size:12.5px}
    .bd{padding:12px; overflow:auto}
    label{display:block;color:var(--muted);font-size:11.5px;margin-bottom:6px}
    input[type="text"], input[type="number"], select{
      width:100%;
      padding:9px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.26);
      color:var(--fg);
      outline:none;
    }

    /* File input: black button with white text */
    input[type="file"]{
      width:100%;
      padding:9px 10px;
      border-radius:12px;
      border:1px dashed var(--border);
      background:rgba(0,0,0,.18);
      color:var(--muted);
    }
    input[type="file"]::file-selector-button{
      background:#000;
      color:#fff;
      border:1px solid rgba(255,255,255,.18);
      border-radius:999px;
      padding:7px 10px;
      margin-right:10px;
      cursor:pointer;
      font-weight:700;
    }
    input[type="file"]::file-selector-button:hover{
      border-color:rgba(255,255,255,.32);
    }

    .row{display:grid;grid-template-columns:1fr 1fr; gap:10px}
    .row3{display:grid;grid-template-columns:1fr 1fr 1fr; gap:10px}
    .sep{height:1px;background:var(--border);margin:10px 0}
    .btn{
      border:1px solid var(--border);
      background:rgba(80,255,200,.18);
      color:var(--fg);
      padding:10px 12px;
      border-radius:999px;
      cursor:pointer;
      font-weight:800;
      width:100%;
    }
    .btn:hover{background:rgba(80,255,200,.24)}
    .tiny{margin-top:6px;font-size:11.2px;color:var(--muted);line-height:1.35}
    .status{margin-top:8px;font-size:11.5px;color:var(--muted)}
    .status b{color:var(--fg)}
    .pv{
      border:1px solid var(--border);
      border-radius:14px;
      overflow:hidden;
      background:rgba(0,0,0,.18);
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .pvh{padding:9px 12px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:10px}
    .pvh .t{font-size:12px;font-weight:800}
    .pvh .s{font-size:11.2px;color:var(--muted)}
    .pvb{padding:10px 12px; overflow:auto}
    .thumbs{display:grid;grid-template-columns: repeat(6, minmax(0, 1fr)); gap:10px}
    @media (max-width: 520px){.thumbs{grid-template-columns: repeat(4, minmax(0, 1fr));}}
    .thumb{
      display:flex;flex-direction:column;align-items:center;gap:6px;
      padding:8px;border-radius:12px;border:1px solid rgba(255,255,255,.08);
      background:rgba(255,255,255,.03);
    }
    .cap{font-family:var(--mono);font-size:10.5px;color:var(--muted);text-align:center;word-break:break-word}
    .hint{
      padding:10px 12px;border-radius:14px;border:1px solid var(--border);
      background:rgba(0,0,0,.18); color:var(--muted); font-size:12px; line-height:1.4;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>osu!mania — Score/Combo Archives (Font → PNG)</h1>
        <div class="sub">
          Preview shows <span style="font-family:var(--mono)">@2x only</span>.
          ZIP contains: <span style="font-family:var(--mono)">normal (@2x + 1x)</span> + <span style="font-family:var(--mono)">my-style</span>.
        </div>
      </div>
    </header>

    <div class="grid">
      <!-- SETTINGS -->
      <section class="card">
        <div class="hd">
          <b>Settings</b>
          <span class="tiny" style="margin:0">Score: 0–9 + dot/percent/x/comma • Combo: 0–9</span>
        </div>
        <div class="bd">
          <div class="row">
            <div>
              <label>Score prefix</label>
              <input id="scorePrefix" type="text" value="score-" />
            </div>
            <div>
              <label>Combo prefix</label>
              <input id="comboPrefix" type="text" value="mania-combo-" />
            </div>
          </div>

          <div class="row" style="margin-top:10px;">
            <div>
              <label>Score font (.ttf/.otf)</label>
              <input id="scoreFont" type="file" accept=".ttf,.otf" />
            </div>
            <div>
              <label>Combo font (.ttf/.otf)</label>
              <input id="comboFont" type="file" accept=".ttf,.otf" />
            </div>
          </div>

          <div class="sep"></div>

          <div class="row3">
            <div>
              <label>Normal @2x (W×H)</label>
              <div class="row" style="gap:8px">
                <input id="nW" type="number" min="1" step="1" value="44" />
                <input id="nH" type="number" min="1" step="1" value="66" />
              </div>
              <div class="tiny">1x is auto downscale to half.</div>
            </div>
            <div>
              <label>My style canvas</label>
              <input id="mySize" type="number" min="1" step="1" value="350" />
              <div class="tiny">Draws in top-right (clamped).</div>
            </div>
            <div>
              <label>My style padding</label>
              <input id="myPad" type="number" min="0" step="1" value="6" />
            </div>
          </div>

          <div class="sep"></div>

          <div class="row">
            <div>
              <label>Score: size / color</label>
              <div class="row" style="gap:8px">
                <input id="scoreSize" type="number" min="1" step="1" value="52" />
                <input id="scoreColor" type="text" value="#FFFFFF" />
              </div>
              <div class="row" style="gap:8px;margin-top:8px">
                <input id="scoreOffX" type="number" step="1" value="0" />
                <input id="scoreOffY" type="number" step="1" value="0" />
              </div>
              <div class="tiny">Offsets: X then Y.</div>
            </div>

            <div>
              <label>Combo: size / color</label>
              <div class="row" style="gap:8px">
                <input id="comboSize" type="number" min="1" step="1" value="52" />
                <input id="comboColor" type="text" value="#FFFFFF" />
              </div>
              <div class="row" style="gap:8px;margin-top:8px">
                <input id="comboOffX" type="number" step="1" value="0" />
                <input id="comboOffY" type="number" step="1" value="0" />
              </div>
              <div class="tiny">Offsets: X then Y.</div>
            </div>
          </div>

          <div class="sep"></div>

          <button id="btnDownload" class="btn">Download Archives</button>

          <div class="status" id="status">Status: <b>ready</b>.</div>
          <div class="tiny">
            ZIP layout:
            <span style="font-family:var(--mono)">/normal/</span> (files for osu) +
            <span style="font-family:var(--mono)">/my-style/</span> (350×350 variants)
          </div>

          <div class="hint" style="margin-top:10px">
            If the ZIP button does nothing, your browser may have blocked CDN access.
            Try opening the file with internet access, or ask me to embed JSZip directly into the HTML.
          </div>
        </div>
      </section>

      <!-- PREVIEW -->
      <section class="card">
        <div class="hd">
          <b>Preview (@2x only)</b>
          <span class="tiny" style="margin:0">Normal shows 44×66 • My style shows 350×350</span>
        </div>
        <div class="bd" style="display:grid; gap:10px; min-height:0">
          <div class="pv">
            <div class="pvh">
              <div>
                <div class="t">Score @2x</div>
                <div class="s" id="infoScore">—</div>
              </div>
              <div class="s" id="tagScore">—</div>
            </div>
            <div class="pvb"><div class="thumbs" id="pvScore"></div></div>
          </div>

          <div class="pv">
            <div class="pvh">
              <div>
                <div class="t">Combo @2x</div>
                <div class="s" id="infoCombo">—</div>
              </div>
              <div class="s" id="tagCombo">—</div>
            </div>
            <div class="pvb"><div class="thumbs" id="pvCombo"></div></div>
          </div>
        </div>
      </section>
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  // Required glyph sets
  const SCORE_GLYPHS = ['1','2','3','4','5','6','7','8','9','0','.', '%', 'x', ','];
  const COMBO_GLYPHS = ['1','2','3','4','5','6','7','8','9','0'];

  // osu-ish naming for special score glyphs
  const scoreKeyForGlyph = (g) => {
    if (g >= '0' && g <= '9') return g;
    if (g === '.') return 'dot';
    if (g === '%') return 'percent';
    if (g === 'x') return 'x';
    if (g === ',') return 'comma';
    return g;
  };

  const el = {
    scorePrefix: $('scorePrefix'),
    comboPrefix: $('comboPrefix'),
    scoreFont: $('scoreFont'),
    comboFont: $('comboFont'),

    nW: $('nW'),
    nH: $('nH'),
    mySize: $('mySize'),
    myPad: $('myPad'),

    scoreSize: $('scoreSize'),
    scoreColor: $('scoreColor'),
    scoreOffX: $('scoreOffX'),
    scoreOffY: $('scoreOffY'),

    comboSize: $('comboSize'),
    comboColor: $('comboColor'),
    comboOffX: $('comboOffX'),
    comboOffY: $('comboOffY'),

    btnDownload: $('btnDownload'),
    status: $('status'),

    pvScore: $('pvScore'),
    pvCombo: $('pvCombo'),
    infoScore: $('infoScore'),
    infoCombo: $('infoCombo'),
    tagScore: $('tagScore'),
    tagCombo: $('tagCombo'),
  };

  let fontScore = 'sans-serif';
  let fontCombo = 'sans-serif';

  const makeCanvas = (w,h) => { const c=document.createElement('canvas'); c.width=w; c.height=h; return c; };
  const setStatus = (t) => el.status.innerHTML = `Status: <b>${t}</b>.`;
  const sanitizePrefix = (p) => (p||'').trim();

  async function loadFontFromFile(file, base){
    if(!file) return 'sans-serif';
    const ab = await file.arrayBuffer();
    const blob = new Blob([ab], {type:"font/ttf"});
    const url = URL.createObjectURL(blob);
    const family = `${base}-${Math.random().toString(16).slice(2)}`;
    const ff = new FontFace(family, `url(${url})`);
    await ff.load();
    document.fonts.add(ff);
    return family;
  }

  function clear(ctx,w,h){ ctx.clearRect(0,0,w,h); }

  function drawCentered(ctx, text, w, h, family, size, color, ox, oy){
    ctx.save();
    ctx.font = `${size}px "${family}", sans-serif`;
    ctx.fillStyle = color;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.imageSmoothingEnabled = true;
    ctx.fillText(text, w/2 + ox, h/2 + oy);
    ctx.restore();
  }

  function drawTopRight(ctx, text, w, h, family, size, color, pad, ox, oy){
    ctx.save();
    ctx.font = `${size}px "${family}", sans-serif`;
    ctx.fillStyle = color;
    ctx.textAlign = 'left';
    ctx.textBaseline = 'alphabetic';
    ctx.imageSmoothingEnabled = true;

    const m = ctx.measureText(text);
    const asc = m.actualBoundingBoxAscent || size*0.8;
    const desc = m.actualBoundingBoxDescent || size*0.2;
    const tw = m.width;

    let x = (w - pad - tw) + ox;
    let y = (pad + asc) + oy;

    // clamp inside canvas
    x = Math.max(0, Math.min(x, w - tw));
    y = Math.max(asc, Math.min(y, h - desc));

    ctx.fillText(text, x, y);
    ctx.restore();
  }

  function downscale(src, w, h){
    const out = makeCanvas(w,h);
    const o = out.getContext('2d');
    o.imageSmoothingEnabled = true;
    o.clearRect(0,0,w,h);
    o.drawImage(src, 0,0,w,h);
    return out;
  }

  const canvasToBlob = (c) => new Promise(res => c.toBlob(res,'image/png'));

  function fillPreview(container, map){
    container.innerHTML = '';
    for(const [name, canvas] of map.entries()){
      const box = document.createElement('div');
      box.className = 'thumb';
      const c = makeCanvas(canvas.width, canvas.height);
      c.getContext('2d').drawImage(canvas,0,0);
      box.appendChild(c);
      const cap = document.createElement('div');
      cap.className = 'cap';
      cap.textContent = name.replace(/^.*\//,''); // show file only
      box.appendChild(cap);
      container.appendChild(box);
    }
  }

  function renderNormalAndMy({prefix, family, size, color, ox, oy, nW, nH, mySize, myPad, glyphs, keyForGlyph, isScore}){
    const pref = sanitizePrefix(prefix);

    const normal2x = new Map(); // filename -> canvas
    const normal1x = new Map(); // filename -> canvas
    const my = new Map();       // filename -> canvas

    for(const g of glyphs){
      const key = keyForGlyph ? keyForGlyph(g) : g;

      // Normal
      const c2 = makeCanvas(nW,nH);
      const ctx2 = c2.getContext('2d');
      clear(ctx2,nW,nH);
      drawCentered(ctx2, g, nW,nH, family, size, color, ox, oy);

      const c1 = downscale(c2, Math.round(nW/2), Math.round(nH/2));

      // keep osu-friendly names in /normal root
      normal2x.set(`${pref}${key}@2x.png`, c2);
      normal1x.set(`${pref}${key}.png`, c1);

      // My style (in /my-style to avoid conflicts)
      const S = mySize;
      const cm = makeCanvas(S,S);
      const ctxm = cm.getContext('2d');
      clear(ctxm,S,S);
      drawTopRight(ctxm, g, S,S, family, size, color, myPad, ox, oy);
      my.set(`${pref}${key}.png`, cm);
    }

    return { normal2x, normal1x, my };
  }

  async function ensureFonts(){
    setStatus('loading fonts');
    fontScore = await loadFontFromFile(el.scoreFont.files?.[0] || null, 'ScoreFont');
    fontCombo = await loadFontFromFile(el.comboFont.files?.[0] || null, 'ComboFont');
    setStatus('fonts ready');
  }

  function renderPreview(){
    const nW = Math.max(1, parseInt(el.nW.value||'44',10));
    const nH = Math.max(1, parseInt(el.nH.value||'66',10));
    const mySize = Math.max(1, parseInt(el.mySize.value||'350',10));
    const myPad = Math.max(0, parseInt(el.myPad.value||'6',10));

    const score = renderNormalAndMy({
      prefix: el.scorePrefix.value,
      family: fontScore,
      size: parseInt(el.scoreSize.value||'52',10),
      color: (el.scoreColor.value||'#fff').trim(),
      ox: parseInt(el.scoreOffX.value||'0',10),
      oy: parseInt(el.scoreOffY.value||'0',10),
      nW, nH, mySize, myPad,
      glyphs: SCORE_GLYPHS,
      keyForGlyph: scoreKeyForGlyph,
      isScore: true
    });

    const combo = renderNormalAndMy({
      prefix: el.comboPrefix.value,
      family: fontCombo,
      size: parseInt(el.comboSize.value||'52',10),
      color: (el.comboColor.value||'#fff').trim(),
      ox: parseInt(el.comboOffX.value||'0',10),
      oy: parseInt(el.comboOffY.value||'0',10),
      nW, nH, mySize, myPad,
      glyphs: COMBO_GLYPHS
    });

    // Preview shows @2x only (normal @2x)
    fillPreview(el.pvScore, score.normal2x);
    fillPreview(el.pvCombo, combo.normal2x);

    el.infoScore.textContent = `${nW}×${nH} • 0–9 + dot/percent/x/comma`;
    el.infoCombo.textContent = `${nW}×${nH} • 0–9`;
    el.tagScore.textContent = 'Normal @2x';
    el.tagCombo.textContent = 'Normal @2x';

    return {score, combo, nW, nH, mySize};
  }

  async function downloadArchives(){
    try{
      if(!window.JSZip){
        setStatus('JSZip missing (CDN blocked)');
        return;
      }

      await ensureFonts();
      setStatus('rendering');

      const nW = Math.max(1, parseInt(el.nW.value||'44',10));
      const nH = Math.max(1, parseInt(el.nH.value||'66',10));
      const mySize = Math.max(1, parseInt(el.mySize.value||'350',10));
      const myPad = Math.max(0, parseInt(el.myPad.value||'6',10));

      const score = renderNormalAndMy({
        prefix: el.scorePrefix.value,
        family: fontScore,
        size: parseInt(el.scoreSize.value||'52',10),
        color: (el.scoreColor.value||'#fff').trim(),
        ox: parseInt(el.scoreOffX.value||'0',10),
        oy: parseInt(el.scoreOffY.value||'0',10),
        nW, nH, mySize, myPad,
        glyphs: SCORE_GLYPHS,
        keyForGlyph: scoreKeyForGlyph
      });

      const combo = renderNormalAndMy({
        prefix: el.comboPrefix.value,
        family: fontCombo,
        size: parseInt(el.comboSize.value||'52',10),
        color: (el.comboColor.value||'#fff').trim(),
        ox: parseInt(el.comboOffX.value||'0',10),
        oy: parseInt(el.comboOffY.value||'0',10),
        nW, nH, mySize, myPad,
        glyphs: COMBO_GLYPHS
      });

      const zip = new JSZip();

      // /normal: osu-friendly files (root of that folder)
      const normal = zip.folder('normal');
      // score normal
      for(const [name, canvas] of score.normal2x.entries()){
        normal.file(name, await canvasToBlob(canvas));
      }
      for(const [name, canvas] of score.normal1x.entries()){
        normal.file(name, await canvasToBlob(canvas));
      }
      // combo normal
      for(const [name, canvas] of combo.normal2x.entries()){
        normal.file(name, await canvasToBlob(canvas));
      }
      for(const [name, canvas] of combo.normal1x.entries()){
        normal.file(name, await canvasToBlob(canvas));
      }

      // /my-style: 350×350 variants (kept separate to avoid filename collisions)
      const my = zip.folder('my-style');
      const myScore = my.folder('score');
      const myCombo = my.folder('combo');

      for(const [name, canvas] of score.my.entries()){
        myScore.file(name, await canvasToBlob(canvas));
      }
      for(const [name, canvas] of combo.my.entries()){
        myCombo.file(name, await canvasToBlob(canvas));
      }

      setStatus('zipping');

      const blob = await zip.generateAsync({type:'blob', compression:'DEFLATE', compressionOptions:{level:6}});
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = 'osu-archives.zip';
      document.body.appendChild(a);
      a.click();
      a.remove();

      setTimeout(()=>URL.revokeObjectURL(url), 2000);
      setStatus('done');
    }catch(e){
      console.error(e);
      setStatus('error (check console)');
    }
  }

  // Live preview updates (fast): rerender normal @2x only
  let debounceT = null;
  function schedulePreview(){
    clearTimeout(debounceT);
    debounceT = setTimeout(async () => {
      try{
        await ensureFonts();
        renderPreview();
        setStatus('preview updated');
      }catch(e){
        console.error(e);
        setStatus('error (check console)');
      }
    }, 150);
  }

  // Bindings
  el.btnDownload.addEventListener('click', downloadArchives);

  // Any change updates preview
  const watch = [
    'scorePrefix','comboPrefix','scoreFont','comboFont',
    'nW','nH','mySize','myPad',
    'scoreSize','scoreColor','scoreOffX','scoreOffY',
    'comboSize','comboColor','comboOffX','comboOffY'
  ];
  watch.forEach(id => $(id).addEventListener('input', schedulePreview));
  $('scoreFont').addEventListener('change', schedulePreview);
  $('comboFont').addEventListener('change', schedulePreview);

  // initial
  (async () => {
    try{
      await ensureFonts();
      renderPreview();
      setStatus('ready');
    }catch(e){
      setStatus('ready');
    }
  })();
})();
</script>
</body>
</html>
